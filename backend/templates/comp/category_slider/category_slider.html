<div class="flex justify-center mb-8">
    <div id="category-carousel" class="splide" slides-count="{{ categories_context|length }}">
        <div class="splide__track">
            <ul class="splide__list">
                {% for category in categories_context %}
                <li class="splide__slide">
                    {% if category.show_navbar %}
                    <div class="group">
                        <a href="{{ category.link }}">
                            <!-- Max width control -->
                            {% if current_category == category.name %}
                            <div class="w-24 h-24 rounded-lg bg-red-100 p-2 border mx-1" id="selected-category"
                                category-index="{{ forloop.counter }}">
                                {% if category.icon %}
                                <img src="{{ category.icon.url }}">
                                {% endif %}
                                <div class="text-center text-sm">{{ category.name }}</div>
                            </div>
                            {% else %}
                            <div class="w-24 h-24 rounded-xl p-2 border  mx-1">
                                {% if category.icon %}
                                <img src="{{ category.icon.url }}">
                                {% endif %}
                                <div class="text-center text-sm">{{ category.name }}</div>
                            </div>
                            {% endif %}
                        </a>
                    </div>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

<script>
    let slidesPerPage = 8;
    let goToIndex = 0;
    let categoryCarousel = document.getElementById('category-carousel');
    let selectedCategory = document.getElementById("selected-category");
    let slidesCount = categoryCarousel.getAttribute('slides-count');

    if (selectedCategory) {
        let currentIndex = selectedCategory.getAttribute('category-index');
        let spread = currentIndex - slidesPerPage;
        if (spread > 0) {
            goToIndex = spread + 1;
        }
    }

    console.log(goToIndex);

    document.addEventListener("DOMContentLoaded", function () {
        new Splide("#category-carousel", {
            type: 'loop',
            perPage: slidesPerPage,
            perMove: 1,
            pagination: false,
        }).mount().go(goToIndex);
    });
</script>